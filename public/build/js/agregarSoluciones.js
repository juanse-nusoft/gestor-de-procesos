document.addEventListener("DOMContentLoaded",(e=>{let t=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{list:"ordered"},{list:"bullet"}],["bold","italic","underline"],[{align:[]}],["link","image"]],clipboard:!0}});function r(e){fetch("/dashboard/soluciones/crear",{method:"POST",body:e}).then((e=>e.json())).then((e=>{e.success?Swal.fire({icon:"success",title:"¡Éxito!",text:"La solución se guardó correctamente",confirmButtonText:"Aceptar"}).then((()=>{e.redirect&&(window.location.href=e.redirect)})):Swal.fire({icon:"error",title:"Error",text:e.message||"Error al guardar",confirmButtonText:"Aceptar"})})).catch((e=>{Swal.fire({icon:"error",title:"Error",text:"Error de conexión con el servidor",confirmButtonText:"Aceptar"}),console.error("Error:",e)}))}t.root.addEventListener("paste",(function(e){let r=(e.clipboardData||e.originalEvent.clipboardData).items;for(let e of r)if(0===e.type.indexOf("image")){let r=e.getAsFile(),o=new FileReader;o.onload=function(e){let r=e.target.result,o=t.getSelection();t.insertEmbed(o.index,"image",r)},o.readAsDataURL(r)}})),document.getElementById("formulario").addEventListener("submit",(function(e){e.preventDefault();let o=t.root.innerHTML,a=new FormData(this),i=o.match(/<img[^>]+src="(data:image\/[^;]+;base64,[^"]+)"/g);if(i){let e=i.map((e=>{let t=e.match(/src="(data:image\/[^;]+;base64,[^"]+)"/)[1];return fetch("/dashboard/soluciones/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:t})}).then((e=>e.json())).then((e=>(e.success&&(o=o.split(t).join(e.url)),e)))}));Promise.all(e).then((()=>{a.set("descripcion",o),r(a)})).catch((e=>{console.error("Detalles del error:",{error:e.message,stack:e.stack,base64:base64}),alert("Error al subir imágenes")}))}else a.set("descripcion",o),r(a)}))}));
document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".opciones-perfil"),t=document.getElementById("modalOpcionesPerfil"),o=document.getElementById("inputFotoPerfil"),n=document.querySelector(".foto-perfil"),r=document.getElementById("eliminarFoto"),i=document.getElementById("subirFoto"),c=document.getElementById("toggle-password"),s=document.getElementById("campo-contrasena");e.addEventListener("click",(function(e){e.stopPropagation(),t.style.display="flex"})),i.addEventListener("click",(function(){t.style.display="none",o.click()})),t.addEventListener("click",(function(e){(e.target.classList.contains("modal-opciones-perfil")||e.target.classList.contains("cerrar-modal"))&&(t.style.display="none")})),o.addEventListener("change",(function(e){this.files&&this.files[0]&&Swal.fire({title:"¿Estás seguro?",text:"¿Deseas cambiar tu foto de perfil?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, cambiar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed?function(e){const t=new FormData;t.append("imagen",e),fetch("/dashboard/usuarios/upload-perfil",{method:"POST",body:t}).then((e=>e.json())).then((e=>{e.success?(Swal.fire({icon:"success",title:"¡Éxito!",text:"Foto de perfil actualizada correctamente",timer:2e3,showConfirmButton:!1}),n.src=e.imagen):Swal.fire({icon:"error",title:"Error",text:e.error||"Error al subir la imagen"})})).catch((e=>{Swal.fire({icon:"error",title:"Error",text:"Error de conexión con el servidor"}),console.error("Error:",e)}))}(this.files[0]):this.value=""}))})),r.addEventListener("click",(function(){Swal.fire({title:"¿Eliminar foto de perfil?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&fetch("/dashboard/usuarios/delete-perfil",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"eliminar=true"}).then((e=>{if(!e.ok)throw new Error("HTTP error "+e.status);return e.json().catch((()=>{throw new Error("Respuesta no es JSON válido")}))})).then((e=>{if(!e.success)throw new Error(e.error||"Error desconocido");document.querySelector(".foto-perfil").src=e.imagen,Swal.fire("¡Éxito!","Foto eliminada","success"),t.style.display="none"})).catch((e=>{console.error("Error completo:",e),Swal.fire("Error",e.message,"error")}))}))})),c.addEventListener("click",(function(){this.classList.toggle("active"),s.style.display=this.classList.contains("active")?"flex":"none"}))}));
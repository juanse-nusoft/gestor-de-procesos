document.addEventListener("DOMContentLoaded",(()=>{let e=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{list:"ordered"},{list:"bullet"}],["bold","italic","underline"],[{align:[]}],["link","image"]],clipboard:!0}});function t(e){fetch("/dashboard/soluciones/editar",{method:"POST",body:e}).then((e=>e.json())).then((e=>{e.success?Swal.fire({icon:"success",title:"¡Éxito!",text:"La solución se guardó correctamente",confirmButtonText:"Aceptar"}).then((()=>{e.redirect&&(window.location.href=e.redirect)})):Swal.fire({icon:"error",title:"Error",text:e.message||"Error al guardar",confirmButtonText:"Aceptar"})})).catch((e=>{Swal.fire({icon:"error",title:"Error",text:"Error de conexión con el servidor",confirmButtonText:"Aceptar"}),console.error("Error:",e)}))}e.root.addEventListener("paste",(function(t){let r=(t.clipboardData||t.originalEvent.clipboardData).items;for(let t of r)if(0===t.type.indexOf("image")){let r=t.getAsFile(),o=new FileReader;o.onload=function(t){let r=t.target.result,o=e.getSelection();e.insertEmbed(o.index,"image",r)},o.readAsDataURL(r)}}));let r=document.getElementById("descripcionServidor").dataset.content,o=new Set;if(r){e.root.innerHTML=r,e.focus(),e.root.querySelectorAll("img").forEach((e=>{let t=e.getAttribute("src");t.startsWith("data:image")||o.add(t)}))}document.getElementById("formulario").addEventListener("submit",(function(r){r.preventDefault();let i=e.root.innerHTML,n=new FormData(this),a=e.root.querySelectorAll("img"),l=[];if(a.forEach((e=>{let t=e.getAttribute("src");t.startsWith("data:image")?l.push(t):o.has(t)||console.warn("Imagen desconocida detectada:",t)})),l.length>0){let e=l.map((e=>fetch("/dashboard/soluciones/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:e})}).then((e=>e.json())).then((t=>(t.success&&(i=i.split(e).join(t.url)),t)))));Promise.all(e).then((()=>{n.set("descripcion",i),t(n)})).catch((e=>{console.error("Error al subir imágenes:",e),alert("Hubo un error al subir imágenes.")}))}else n.set("descripcion",i),t(n)}))}));